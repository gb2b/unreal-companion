---
description: Unreal Companion project conventions and tool usage
globs: 
alwaysApply: true
---

# Unreal Companion - Project Guide

## âš ï¸ Security: Token + Whitelist System

| Risk | Whitelistable? | Examples |
|------|----------------|----------|
| ğŸ”´ CRITICAL | Never | `python_execute`, `python_execute_file` |
| ğŸŸ  HIGH | Never | `console(quit/exit/open)` |
| ğŸŸ¡ MEDIUM | âœ… After approval | `console(slomo/killall)` |

**CRITICAL/HIGH Flow:**
```python
result = python_execute(code="...")  # Get token
# Show to user, ask approval
python_execute(code="...", confirmation_token=token)
```

**MEDIUM Flow (with whitelist option):**
```python
result = console(command="slomo 0.5")  # Get token + can_whitelist=true
# Ask: "Approve? (yes / yes always / no)"
console(command="slomo 0.5", confirmation_token=token, whitelist_for_session=True)
# Future slomo â†’ no confirmation needed
```

**If `blocked: true`** â†’ Hard block, do NOT retry

## Quick Tool Reference

| Task | Tool |
|------|------|
| Query/Find | `core_query(type, action, ...)` |
| Get info | `core_get_info(type, ...)` |
| Save | `core_save(scope)` |
| Create Blueprint | `blueprint_create(name, parent_class, path)` |
| BP variables | `blueprint_variable_batch(bp, operations)` |
| BP components | `blueprint_component_batch(bp, components, ...)` |
| BP functions | `blueprint_function_batch(bp, operations)` |
| Graph nodes | `graph_batch(bp, nodes, connections, ...)` |
| Spawn actors | `world_spawn_batch(actors)` |
| Modify actors | `world_set_batch(actors)` |
| Delete actors | `world_delete_batch(actors)` |
| Create material | `material_create(name, path)` |
| Screenshot | `viewport_screenshot(width, height)` |

**Note**: All batch tools support `on_error`, `dry_run`, `verbosity`, and auto-compile.

## Coordinate System

| Axis | Color | Direction |
|------|-------|-----------|
| X | Red | Forward (+) / Backward (-) |
| Y | Green | Right (+) / Left (-) |
| Z | Blue | Up (+) / Down (-) |

**Z-up, left-handed** coordinate system. Units: cm, kg, degrees.

## Common Paths

```
/Game/                  â†’ Content root
/Game/Blueprints/       â†’ Blueprints
/Game/Materials/        â†’ Materials
/Game/UI/               â†’ UMG Widgets
/Game/Maps/             â†’ Levels
/Engine/BasicShapes/    â†’ Engine shapes (Cube, Sphere, etc.)
```

## Recommended Workflow

### Creating a Blueprint

```
1. core_query(type="asset", action="exists", path=...)  â†’ Check if exists
2. blueprint_create(name, parent, path)                  â†’ Create
3. blueprint_variable_batch(bp, operations=[...])        â†’ Add variables
4. blueprint_component_batch(bp, components=[...])       â†’ Add components
5. graph_batch(bp, nodes=[...], connections=[...])       â†’ Add logic
6. core_save(scope="all")                                â†’ Save
```

### Building Graph Logic

```
1. core_get_info(type="blueprint", path=...)            â†’ Get BP info
2. node_search_available(search_term=...)               â†’ Find available nodes
3. graph_batch(                                          â†’ Add nodes + connect
       blueprint_name=...,
       nodes=[{"ref": "a", ...}, {"ref": "b", ...}],
       connections=[{"source_ref": "a", ...}],
       auto_arrange=True
   )
```

## Common Mistakes

### Paths
- âœ… `/Game/Blueprints/BP_MyActor`
- âŒ `BP_MyActor`
- âŒ `Game/Blueprints/BP_MyActor`

### Vectors/Rotations
- âœ… `[100.0, 200.0, 50.0]`
- âŒ `"100, 200, 50"`
- âŒ `{x: 100, y: 200, z: 50}`

### Pin Names
- Case-sensitive
- Use `graph_node_info()` to verify exact names
- Common: `execute`, `then`, `ReturnValue`

## Plugin Architecture

```
Plugins/UnrealCompanion/
â”œâ”€â”€ Source/UnrealCompanion/
â”‚   â”œâ”€â”€ Public/Commands/     â†’ C++ headers
â”‚   â””â”€â”€ Private/
â”‚       â”œâ”€â”€ Commands/        â†’ C++ implementations
â”‚       â”œâ”€â”€ Graph/           â†’ Graph operations & NodeFactories
â”‚       â””â”€â”€ UnrealCompanionBridge.cpp â†’ Main command routing
```

```
Python/tools/
â”œâ”€â”€ core_tools.py       â†’ core_*
â”œâ”€â”€ blueprint_tools.py  â†’ blueprint_*
â”œâ”€â”€ graph_tools.py      â†’ graph_*
â”œâ”€â”€ world_tools.py      â†’ world_*
â”œâ”€â”€ material_tools.py   â†’ material_*
â”œâ”€â”€ widget_tools.py     â†’ widget_*
â”œâ”€â”€ level_tools.py      â†’ level_*
â”œâ”€â”€ light_tools.py      â†’ light_*
â”œâ”€â”€ viewport_tools.py   â†’ viewport_*
â”œâ”€â”€ editor_tools.py     â†’ editor_*
â”œâ”€â”€ python_tools.py     â†’ python_*
â””â”€â”€ project_tools.py    â†’ project_*
```
