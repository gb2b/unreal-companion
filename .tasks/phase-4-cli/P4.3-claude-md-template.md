# P4.3 CLAUDE.md Template

## Objectif

Cr√©er un template CLAUDE.md g√©n√©r√© automatiquement pour chaque projet, avec le contexte projet, les workflows disponibles, et les instructions pour les agents.

## Pr√©requis

- [x] P1.2 - Structure projet avec context.md
- [x] P1.4 - CLI Setup (infrastructure Node.js)
- [x] P4.1 - Workflows CLI

## Fichiers √† Cr√©er

- `web-ui/server/templates/CLAUDE.md.template` - Template de base
- `web-ui/server/services/claudemd_service.py` - G√©n√©ration dynamique

## Sp√©cifications

### Template CLAUDE.md

```markdown
# {{PROJECT_NAME}} - Unreal Companion

> Auto-generated context file for AI assistants.
> Last updated: {{GENERATED_AT}}

## Project Overview

{{PROJECT_CONTEXT}}

## Quick Commands

### MCP Tools (Editor Mode)

```bash
# Start MCP server
cd {{COMPANION_PATH}}
python Python/unreal_mcp_server.py
```

Common requests:
- "Create a Blueprint called BP_X"
- "Add component Y to BP_X"
- "Create a material with Z properties"
- "Save all modified assets"

### Workflows (Studio Mode)

```bash
# Available workflows
npx unreal-companion workflow list

# Quick start (2 min)
npx unreal-companion workflow start quick-start

# Full game brief (15-30 min)
npx unreal-companion workflow start game-brief

# Brainstorm session (10 min)
npx unreal-companion workflow start brainstorm
```

## Project Structure

```
{{PROJECT_PATH}}/
‚îú‚îÄ‚îÄ .unreal-companion/
‚îÇ   ‚îú‚îÄ‚îÄ artifacts/          # Generated documents
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ briefs/         # Game briefs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ design/         # GDD, mechanics
‚îÇ   ‚îú‚îÄ‚îÄ tasks/              # Production board tasks
‚îÇ   ‚îî‚îÄ‚îÄ context.md          # AI context (this feeds me)
‚îú‚îÄ‚îÄ Content/                # Unreal assets
‚îÇ   ‚îú‚îÄ‚îÄ _Core/              # Core systems
‚îÇ   ‚îú‚îÄ‚îÄ Blueprints/         # Blueprint assets
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ {{PROJECT_NAME}}.uproject
```

## Current Focus

{{CURRENT_FOCUS}}

## Available Agents

| Agent | Role | When to Use |
|-------|------|-------------|
| üé≤ Game Designer | Mechanics, gameplay | Design discussions |
| üèõÔ∏è Architect | Systems, architecture | Technical planning |
| üé® 3D Artist | Visuals, materials | Art direction |
| üó∫Ô∏è Level Designer | Levels, flow | World building |
| ü§ñ Unreal Agent | MCP execution | Building in UE |

## Key Artifacts

{{ARTIFACTS_LIST}}

## Active Tasks

{{ACTIVE_TASKS}}

## Conventions

### Naming
- Blueprints: `BP_*`
- Materials: `M_*`
- Widgets: `WBP_*`
- Levels: `L_*`

### Code Style
- Blueprint first (C++ only when necessary)
- Comments in English
- Variables in PascalCase

## Notes

{{PROJECT_NOTES}}

---
*This file is auto-generated. Edit `.unreal-companion/context.md` to update project context.*
```

### Service de G√©n√©ration

```python
class ClaudeMDService:
    def __init__(self, project_path: str):
        self.project_path = Path(project_path)
        self.companion_path = self.project_path / ".unreal-companion"

    def generate(self) -> str:
        """G√©n√®re le contenu du CLAUDE.md."""

        template = self.load_template()

        variables = {
            "PROJECT_NAME": self.get_project_name(),
            "PROJECT_PATH": str(self.project_path),
            "COMPANION_PATH": str(self.companion_path),
            "GENERATED_AT": datetime.now().isoformat(),
            "PROJECT_CONTEXT": self.load_project_context(),
            "CURRENT_FOCUS": self.get_current_focus(),
            "ARTIFACTS_LIST": self.format_artifacts_list(),
            "ACTIVE_TASKS": self.format_active_tasks(),
            "PROJECT_NOTES": self.load_project_notes(),
        }

        return self.render_template(template, variables)

    def load_project_context(self) -> str:
        """Charge le context.md du projet."""
        context_path = self.companion_path / "context.md"
        if context_path.exists():
            return context_path.read_text()
        return "_No context defined yet. Run a workflow to populate._"

    def get_current_focus(self) -> str:
        """D√©termine le focus actuel depuis les tasks."""
        tasks = self.load_active_tasks()

        in_progress = [t for t in tasks if t['status'] == 'in_progress']
        if in_progress:
            task = in_progress[0]
            return f"Currently working on: **{task['title']}** ({task['sector']})"

        ready = [t for t in tasks if t['status'] == 'ready']
        if ready:
            task = ready[0]
            return f"Next up: **{task['title']}** ({task['sector']})"

        return "_No active tasks. Check the Production Board._"

    def format_artifacts_list(self) -> str:
        """Liste les artifacts principaux."""
        index_path = self.companion_path / "artifacts" / "index.yaml"
        if not index_path.exists():
            return "_No artifacts yet._"

        index = yaml.safe_load(index_path.read_text())
        artifacts = index.get('artifacts', [])[:5]  # Top 5

        if not artifacts:
            return "_No artifacts yet._"

        lines = []
        for a in artifacts:
            lines.append(f"- [{a['title']}]({a['path']})")

        return "\n".join(lines)

    def format_active_tasks(self) -> str:
        """Liste les tasks actives."""
        tasks = self.load_active_tasks()

        if not tasks:
            return "_No active tasks._"

        lines = []
        for t in tasks[:5]:  # Top 5
            status_icon = {'ready': '‚ñ∂', 'in_progress': 'üîÑ', 'locked': 'üîí'}.get(t['status'], '‚óã')
            lines.append(f"- {status_icon} {t['title']} ({t['sector']})")

        return "\n".join(lines)

    def write_to_project(self):
        """√âcrit le CLAUDE.md √† la racine du projet."""
        content = self.generate()
        output_path = self.project_path / "CLAUDE.md"
        output_path.write_text(content)
        return output_path
```

### R√©g√©n√©ration Automatique

```python
# Dans project_init.py ou au d√©marrage du serveur
def on_project_change(project_path: str, change_type: str):
    """R√©g√©n√®re CLAUDE.md quand le projet change."""

    if change_type in ['context_updated', 'artifact_created', 'task_changed']:
        service = ClaudeMDService(project_path)
        service.write_to_project()
```

### API Route

```python
# POST /api/project/{id}/regenerate-claude-md
# Force la r√©g√©n√©ration du CLAUDE.md
```

## Crit√®res d'Acceptation

- [ ] Template CLAUDE.md complet
- [ ] G√©n√©ration automatique √† l'init du projet
- [ ] Mise √† jour quand context.md change
- [ ] Mise √† jour quand artifacts ajout√©s
- [ ] Mise √† jour quand tasks changent
- [ ] Liste des workflows disponibles
- [ ] Liste des agents
- [ ] Conventions du projet incluses
- [ ] Tests passent

## Tests √† √âcrire

### Unit Tests

```python
def test_generate_claude_md():
    # V√©rifie la g√©n√©ration compl√®te

def test_artifacts_list_formatting():
    # V√©rifie le format de la liste

def test_active_tasks_formatting():
    # V√©rifie le format des tasks

def test_regeneration_on_change():
    # V√©rifie la r√©g√©n√©ration automatique
```

## Notes

- Le CLAUDE.md doit √™tre lisible par tout assistant IA
- Garder le format simple et scannable
- √âviter de r√©p√©ter tout le GDD (juste pointer vers)
- Pr√©voir un mode verbose pour plus de contexte si besoin
