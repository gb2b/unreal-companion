# P2.8-lite Party Mode Simplifi√© (2-3 agents)

## Objectif

Impl√©menter une version simplifi√©e du Party Mode : 2-3 agents maximum qui discutent d'un sujet, avec tours altern√©s et synth√®se finale.

## Pr√©requis

- [x] P2.5 - Exp√©rience ludique (agents avec personnalit√©)
- [x] P2.6 - Gestion sessions

## Fichiers √† Cr√©er

- `web-ui/src/components/party/PartyMode.tsx` - Interface principale
- `web-ui/src/components/party/PartyMessage.tsx` - Message d'un agent
- `web-ui/src/components/party/PartySummary.tsx` - Synth√®se finale
- `web-ui/server/services/party_service.py` - Orchestration
- `web-ui/server/routes/party.py` - API routes
- `web-ui/src/stores/partyStore.ts` - Store

## Sp√©cifications

### Concept

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üéâ Party Mode : "Comment g√©rer la progression ?"              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                ‚îÇ
‚îÇ  Participants: üé≤ Maya  üèõÔ∏è Alex  üé® Sam                        ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ  üé≤ Maya (Game Designer):                                      ‚îÇ
‚îÇ  "Je vois bien une progression par la connaissance,            ‚îÇ
‚îÇ   pas d'XP. Le joueur apprend le langage, c'est √ßa             ‚îÇ
‚îÇ   qui d√©bloque les zones."                                     ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ  üèõÔ∏è Alex (Architect):                                          ‚îÇ
‚îÇ  "Techniquement √ßa veut dire un syst√®me de flags               ‚îÇ
‚îÇ   persistants. On peut faire un DataAsset pour                 ‚îÇ
‚îÇ   tracker les mots appris."                                    ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ  üé® Sam (3D Artist):                                           ‚îÇ
‚îÇ  "Et visuellement, les zones 'd√©bloqu√©es' pourraient           ‚îÇ
‚îÇ   changer d'ambiance ? Plus de lumi√®re, de couleur ?"          ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ  üí¨ Toi: [√âcrire...]                                           ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ  [Envoyer]  [Demander √† üé≤ Maya]  [Synth√®se]                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Limitations Version Lite

| Aspect | Lite | Full (Phase 7) |
|--------|------|----------------|
| Nombre d'agents | 2-3 max | Illimit√© |
| Tours | S√©quentiels | Parall√®les possibles |
| Dur√©e | Sessions courtes (5-10 min) | Longues discussions |
| Synth√®se | Simple | Avec action items |

### Flow d'une Session Party

```
1. User pose une question/sujet
        ‚Üì
2. S√©lection des agents (2-3)
        ‚Üì
3. BOUCLE:
   a. Premier agent r√©pond (bas√© sur contexte + sujet)
   b. Deuxi√®me agent rebondit (voit r√©ponse pr√©c√©dente)
   c. Troisi√®me agent ajoute (si pr√©sent)
   d. User peut intervenir ou demander √† un agent sp√©cifique
        ‚Üì
4. User demande synth√®se
        ‚Üì
5. G√©n√©ration synth√®se avec d√©cisions
        ‚Üì
6. Option: cr√©er des tasks depuis la synth√®se
```

### Orchestration Backend

```python
class PartyOrchestrator:
    def __init__(self, agents: List[Agent], topic: str, context: ProjectContext):
        self.agents = agents
        self.topic = topic
        self.context = context
        self.exchanges = []

    async def next_agent_response(self, previous_response: str = None) -> AgentResponse:
        """G√©n√®re la r√©ponse du prochain agent dans la rotation."""
        current_agent = self.get_next_agent()

        prompt = self.build_prompt(
            agent=current_agent,
            topic=self.topic,
            previous_exchanges=self.exchanges,
            previous_response=previous_response
        )

        response = await llm.generate(prompt)

        self.exchanges.append({
            'agent': current_agent.id,
            'message': response,
            'timestamp': datetime.now()
        })

        return AgentResponse(
            agent=current_agent,
            message=response,
            expression=self.detect_expression(response)
        )

    async def generate_summary(self) -> PartySummary:
        """G√©n√®re une synth√®se de la discussion."""
        prompt = SUMMARY_PROMPT.format(
            topic=self.topic,
            exchanges=self.format_exchanges(),
            context=self.context
        )

        summary = await llm.generate(prompt)

        return PartySummary(
            decisions=self.extract_decisions(summary),
            action_items=self.extract_actions(summary),
            raw_summary=summary
        )
```

### Prompts

```python
PARTY_AGENT_PROMPT = """
Tu es {agent_name}, un {agent_role}.

Contexte du projet:
{project_context}

Sujet de discussion: "{topic}"

√âchanges pr√©c√©dents:
{previous_exchanges}

{previous_agent} vient de dire:
"{previous_response}"

R√©ponds en tant que {agent_name}:
- Apporte ton point de vue selon ta sp√©cialit√©
- Rebondis sur ce qui a √©t√© dit (accord, nuance, ou id√©e nouvelle)
- Sois concis (2-4 phrases)
- Reste dans ton r√¥le

Ton expression actuelle: {expression}
"""

SUMMARY_PROMPT = """
Synth√©tise cette discussion de Party Mode.

Sujet: {topic}

√âchanges:
{exchanges}

G√©n√®re:
1. R√©sum√© des points cl√©s (2-3 phrases)
2. D√©cisions prises (liste)
3. Questions ouvertes restantes (si applicable)

Format JSON:
{
  "summary": "...",
  "decisions": ["...", "..."],
  "open_questions": ["..."]
}
"""
```

### API Routes

```python
# POST /api/party
# D√©marre une session Party
# Body: { topic, agent_ids: [max 3], project_id }

# GET /api/party/{id}
# R√©cup√®re l'√©tat de la session

# POST /api/party/{id}/next
# G√©n√®re la prochaine r√©ponse d'agent

# POST /api/party/{id}/user
# Ajoute un message utilisateur
# Body: { message, target_agent_id? }

# POST /api/party/{id}/summary
# G√©n√®re la synth√®se

# POST /api/party/{id}/tasks
# Cr√©e des tasks depuis la synth√®se
```

### Store Zustand

```typescript
interface PartyState {
  session: PartySession | null;
  isLoading: boolean;
  isGenerating: boolean;

  // Actions
  startParty: (topic: string, agentIds: string[]) => Promise<void>;
  getNextResponse: () => Promise<void>;
  sendUserMessage: (message: string, targetAgent?: string) => Promise<void>;
  requestSummary: () => Promise<PartySummary>;
  createTasksFromSummary: (decisions: string[]) => Promise<void>;
  endParty: () => void;
}
```

## Crit√®res d'Acceptation

- [ ] S√©lection de 2-3 agents pour la party
- [ ] D√©finition du sujet de discussion
- [ ] R√©ponses altern√©es des agents
- [ ] Agents qui rebondissent sur les r√©ponses pr√©c√©dentes
- [ ] Intervention utilisateur √† tout moment
- [ ] Possibilit√© de cibler un agent sp√©cifique
- [ ] G√©n√©ration de synth√®se
- [ ] Extraction des d√©cisions
- [ ] Cr√©ation optionnelle de tasks
- [ ] Sauvegarde de la session
- [ ] Tests passent

## Tests √† √âcrire

### Unit Tests

```python
def test_party_orchestration():
    # V√©rifie la rotation des agents

def test_agent_response_with_context():
    # V√©rifie que l'agent voit les √©changes pr√©c√©dents

def test_summary_generation():
    # V√©rifie la g√©n√©ration de synth√®se
```

### Unit Tests (React)

```typescript
describe('PartyMode', () => {
  it('should display all participating agents');
  it('should show messages in order');
  it('should allow user to send messages');
  it('should show summary on request');
});
```

### E2E Tests

```typescript
describe('Party Mode E2E', () => {
  it('should complete a full party discussion');
  it('should generate tasks from decisions');
});
```

## Notes

- Limiter √† 2-3 agents pour √©viter la confusion et les co√ªts
- Sessions courtes (5-10 √©changes max avant synth√®se sugg√©r√©e)
- Chaque agent garde sa personnalit√© (ton, expressions)
- La synth√®se peut √™tre ajout√©e aux artifacts du projet
- Pr√©voir un historique des sessions Party
