# P2.5 ExpÃ©rience Ludique (Agent RÃ©actif, Suggestions)

## Objectif

ImplÃ©menter l'expÃ©rience ludique des workflows : agent rÃ©actif qui commente les rÃ©ponses, suggestions contextuelles, mÃ©moire visible, cÃ©lÃ©brations.

## PrÃ©requis

- [x] P2.4 - Workflows YAML dÃ©finis

## Fichiers Ã  Modifier

- `web-ui/src/components/workflow/WorkflowChat.tsx` - Chat principal
- `web-ui/server/services/llm_service.py` - Service LLM

## Fichiers Ã  CrÃ©er

- `web-ui/src/components/workflow/AgentReaction.tsx` - Affichage rÃ©actions
- `web-ui/src/components/workflow/ContextualSuggestions.tsx` - Suggestions
- `web-ui/src/components/workflow/MilestoneCard.tsx` - CÃ©lÃ©brations
- `web-ui/src/components/workflow/MemoryCallback.tsx` - RÃ©fÃ©rences mÃ©moire
- `web-ui/server/prompts/workflow_prompts.py` - Prompts pour rÃ©actions

## SpÃ©cifications

### Flux d'une Question

```
1. Afficher question (depuis workflow YAML)
        â†“
2. User rÃ©pond
        â†“
3. LLM gÃ©nÃ¨re rÃ©action dynamique
   - Acknowledgment ("J'adore !")
   - Connection ("Ã‡a me rappelle X que tu as dit...")
   - Suggestions contextuelles
        â†“
4. Afficher rÃ©action + suggestions
        â†“
5. Question suivante (avec contexte enrichi)
```

### Prompt pour RÃ©actions

```python
REACTION_PROMPT = """
Tu es {agent_name}, un {agent_role} passionnÃ© qui aide Ã  concevoir un jeu.

Contexte du projet:
{project_context}

RÃ©ponses prÃ©cÃ©dentes de l'utilisateur:
{previous_responses}

L'utilisateur vient de rÃ©pondre Ã  la question "{question_prompt}":
"{user_response}"

GÃ©nÃ¨re une rÃ©action courte et engageante qui:
1. Montre que tu as Ã©coutÃ© (rÃ©fÃ¨re Ã  sa rÃ©ponse)
2. Fait un lien avec les rÃ©ponses prÃ©cÃ©dentes si pertinent
3. Propose 2-4 suggestions pour la prochaine question (si applicable)

Format de rÃ©ponse (JSON):
{
  "acknowledgment": "RÃ©action courte et enthousiaste",
  "connection": "Lien avec rÃ©ponse prÃ©cÃ©dente (ou null)",
  "suggestions": ["Suggestion 1", "Suggestion 2"],
  "expression": "excited|thinking|celebrating|neutral"
}
"""
```

### Interface RÃ©action

```tsx
interface AgentReaction {
  acknowledgment: string;
  connection: string | null;
  suggestions: string[];
  expression: 'excited' | 'thinking' | 'celebrating' | 'neutral';
}

// Affichage
<AgentReaction
  reaction={reaction}
  agent={currentAgent}
  onSuggestionClick={(suggestion) => setInputValue(suggestion)}
/>
```

### Suggestions Contextuelles

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¡ BasÃ© sur ta rÃ©ponse:             â”‚
â”‚                                     â”‚
â”‚ [Exploration mystÃ¨re]               â”‚
â”‚ [Puzzle narratif]                   â”‚
â”‚ [Aventure contemplative]            â”‚
â”‚ [Autre...]                          â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Cliquables pour prÃ©-remplir l'input
- GÃ©nÃ©rÃ©es par le LLM en fonction du contexte
- "Autre..." ouvre un champ texte libre

### MÃ©moire Visible (Callbacks)

```tsx
// Quand le LLM fait rÃ©fÃ©rence Ã  une rÃ©ponse prÃ©cÃ©dente
<MemoryCallback
  reference={{
    question: "Tu parlais de...",
    response: "exploration",
    stepId: "genre"
  }}
  onHighlight={() => scrollToStep('genre')}
/>

// Affichage
<div className="memory-callback">
  <span className="icon">ğŸ’­</span>
  <span>"Tu mentionnais <mark>exploration</mark> tout Ã  l'heure..."</span>
  <button onClick={onHighlight}>Voir</button>
</div>
```

### Milestones & CÃ©lÃ©brations

```tsx
interface Milestone {
  name: string;
  celebration: string;
  unlocks?: string[];  // FonctionnalitÃ©s dÃ©bloquÃ©es
}

// Affichage aprÃ¨s une Ã©tape clÃ©
<MilestoneCard
  milestone={milestone}
  onContinue={goToNextStep}
/>

// Avec confettis/animation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ğŸ‰ Vision DÃ©finie !       â”‚
â”‚                                     â”‚
â”‚  "Tu as posÃ© les bases de ton jeu   â”‚
â”‚   d'exploration mystÃ©rieux inspirÃ©  â”‚
â”‚   d'Outer Wilds. Excellent choix !" â”‚
â”‚                                     â”‚
â”‚  DÃ©bloquÃ©: AperÃ§u Pitch Deck       â”‚
â”‚                                     â”‚
â”‚         [Continuer â†’]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Indicateur de Progression

```
Pas une barre de progression ennuyeuse, mais:

"âœ¨ Vision dÃ©finie ! Plus que 2 Ã©tapes pour ton Game Brief"

Ou avec icÃ´nes d'Ã©tapes:
[âœ… Vision] â†’ [ğŸ”„ Genre] â†’ [â³ MÃ©caniques] â†’ [â³ RÃ©sumÃ©]
```

## CritÃ¨res d'Acceptation

- [ ] LLM gÃ©nÃ¨re des rÃ©actions Ã  chaque rÃ©ponse
- [ ] RÃ©actions affichÃ©es avec expression de l'agent
- [ ] Suggestions contextuelles cliquables
- [ ] RÃ©fÃ©rences aux rÃ©ponses prÃ©cÃ©dentes (mÃ©moire visible)
- [ ] Milestones avec cÃ©lÃ©brations (confettis optionnels)
- [ ] Indicateur de progression non-ennuyeux
- [ ] PersonnalitÃ© de l'agent visible dans les rÃ©actions
- [ ] Tests passent

## Tests Ã  Ã‰crire

### Unit Tests

```typescript
describe('AgentReaction', () => {
  it('should display acknowledgment');
  it('should show connection when present');
  it('should render suggestions as clickable chips');
  it('should show correct agent expression');
});

describe('ContextualSuggestions', () => {
  it('should call onClick with suggestion text');
  it('should show "Other" option');
});

describe('MilestoneCard', () => {
  it('should display celebration message');
  it('should show unlocked features');
  it('should trigger confetti animation');
});
```

### Integration Tests

```python
def test_reaction_generation():
    # VÃ©rifie que le LLM gÃ©nÃ¨re des rÃ©actions valides

def test_context_injection():
    # VÃ©rifie que les rÃ©ponses prÃ©cÃ©dentes sont injectÃ©es
```

## Notes

- Les rÃ©actions doivent Ãªtre courtes (1-2 phrases)
- L'expression de l'agent change selon le contexte
- Ã‰viter les rÃ©actions gÃ©nÃ©riques ("Super!", "Ok!") - personnaliser
- Les suggestions doivent Ãªtre pertinentes au contexte du projet
- PrÃ©voir un mode "rapide" sans rÃ©actions pour les users pressÃ©s
