# P2.2 Boards Visuels Basiques

## Objectif

Cr√©er le syst√®me de boards visuels (Mood Boards, Mind Maps) avec un canvas interactif. Version basique sans IA (suggestions IA dans P2.3).

## Pr√©requis

- [x] P1.2 - Structure artifacts/boards/ cr√©√©e

## Fichiers √† Cr√©er

- `web-ui/src/components/boards/BoardCanvas.tsx` - Canvas principal
- `web-ui/src/components/boards/BoardNode.tsx` - Noeud g√©n√©rique
- `web-ui/src/components/boards/ImageNode.tsx` - Noeud image
- `web-ui/src/components/boards/TextNode.tsx` - Noeud texte/note
- `web-ui/src/components/boards/ConnectionLine.tsx` - Ligne de connexion
- `web-ui/src/components/boards/BoardToolbar.tsx` - Barre d'outils
- `web-ui/src/stores/boardStore.ts` - Store Zustand
- `web-ui/src/types/boards.ts` - Types TypeScript
- `web-ui/server/routes/boards.py` - API routes
- `web-ui/server/services/boards_service.py` - Service backend

## Sp√©cifications

### Format JSON (stockage)

```json
{
  "version": "1.0",
  "type": "moodboard",
  "title": "Main Visual Style",
  "created_at": "2024-01-22T10:00:00Z",
  "updated_at": "2024-01-22T15:30:00Z",
  "layout": "freeform",

  "viewport": {
    "x": 0,
    "y": 0,
    "zoom": 1
  },

  "nodes": [
    {
      "id": "n1",
      "type": "image",
      "position": { "x": 100, "y": 100 },
      "size": { "width": 200, "height": 150 },
      "data": {
        "src": "../assets/references/ref-01.png",
        "caption": "Color palette inspiration"
      },
      "style": {
        "borderRadius": 8
      },
      "tags": ["colors", "atmosphere"]
    },
    {
      "id": "n2",
      "type": "text",
      "position": { "x": 350, "y": 120 },
      "size": { "width": 150, "height": 80 },
      "data": {
        "content": "Ethereal, mystical, ancient",
        "backgroundColor": "#3B82F6"
      }
    }
  ],

  "connections": [
    {
      "id": "c1",
      "from": "n1",
      "to": "n2",
      "label": "evokes",
      "style": {
        "strokeWidth": 2,
        "color": "#888"
      }
    }
  ]
}
```

### Types TypeScript

```typescript
type NodeType = 'image' | 'text' | 'link' | 'embed';
type BoardType = 'moodboard' | 'mindmap' | 'diagram';

interface BoardNode {
  id: string;
  type: NodeType;
  position: { x: number; y: number };
  size: { width: number; height: number };
  data: ImageNodeData | TextNodeData | LinkNodeData;
  style?: Record<string, any>;
  tags?: string[];
}

interface ImageNodeData {
  src: string;
  caption?: string;
  alt?: string;
}

interface TextNodeData {
  content: string;
  backgroundColor?: string;
  textColor?: string;
}

interface Connection {
  id: string;
  from: string;
  to: string;
  label?: string;
  style?: {
    strokeWidth?: number;
    color?: string;
    dashed?: boolean;
  };
}

interface Board {
  id: string;
  type: BoardType;
  title: string;
  created_at: string;
  updated_at: string;
  viewport: { x: number; y: number; zoom: number };
  nodes: BoardNode[];
  connections: Connection[];
}
```

### Canvas Interactions

| Action | Interaction |
|--------|-------------|
| Pan | Click + drag sur fond (ou molette) |
| Zoom | Scroll molette / pinch |
| S√©lectionner | Click sur noeud |
| Multi-s√©lection | Shift + click / rectangle |
| D√©placer | Drag noeud s√©lectionn√© |
| Redimensionner | Handles sur noeud s√©lectionn√© |
| Connecter | Drag depuis point de connexion |
| Supprimer | Delete / Backspace |
| √âditer | Double-click |

### Toolbar

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [üñº Image] [üìù Note] [üîó Link] | [‚üµ Undo] [‚ü∂ Redo] | [‚öô]    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

- **Image** : Ouvre file picker pour upload
- **Note** : Cr√©e un noeud texte
- **Link** : Ajoute un lien URL (preview)
- **Undo/Redo** : Historique local
- **Settings** : Grid, snap, etc.

### API Routes

```python
# GET /api/boards
# Liste les boards du projet

# GET /api/boards/{id}
# R√©cup√®re un board

# POST /api/boards
# Cr√©e un board
# Body: { type, title }

# PUT /api/boards/{id}
# Sauvegarde complet du board
# Body: { ...board }

# DELETE /api/boards/{id}
# Supprime un board

# POST /api/boards/{id}/nodes
# Ajoute un noeud
# Body: { type, position, data }

# POST /api/boards/{id}/upload
# Upload une image
# Multipart form data
```

### Auto-save

```typescript
// Debounced save (500ms apr√®s derni√®re modif)
const saveBoard = useDebouncedCallback(
  async (board: Board) => {
    await api.boards.save(board.id, board);
  },
  500
);

// Appel√© √† chaque modification
useEffect(() => {
  if (hasChanges) {
    saveBoard(board);
  }
}, [board]);
```

## Crit√®res d'Acceptation

- [ ] Canvas avec pan/zoom fluide
- [ ] Cr√©ation de noeuds image
- [ ] Cr√©ation de noeuds texte
- [ ] D√©placement et redimensionnement
- [ ] Connexions entre noeuds
- [ ] Sauvegarde automatique
- [ ] Undo/Redo fonctionnel
- [ ] Upload d'images
- [ ] Liste des boards du projet
- [ ] Cr√©ation/suppression de boards
- [ ] Export JSON
- [ ] Tests passent

## Tests √† √âcrire

### Unit Tests

```typescript
describe('BoardCanvas', () => {
  it('should render nodes at correct positions');
  it('should handle pan and zoom');
  it('should select node on click');
});

describe('BoardNode', () => {
  it('should be draggable');
  it('should be resizable');
  it('should show edit mode on double-click');
});

describe('boardStore', () => {
  it('should add node');
  it('should update node position');
  it('should add connection');
  it('should handle undo/redo');
});
```

### E2E Tests

```typescript
describe('Board E2E', () => {
  it('should create a new mood board');
  it('should add image and text nodes');
  it('should connect nodes');
  it('should save and reload');
});
```

## Notes

- Utiliser react-flow-renderer ou construire custom avec @use-gesture
- Optimiser le rendu pour beaucoup de noeuds (virtualization si n√©cessaire)
- Images stock√©es dans assets/references/ du projet
- Pr√©voir un mode "pr√©sentation" (lecture seule)
