# P2.4 Workflows YAML (D√©finitions)

## Objectif

Cr√©er les d√©finitions YAML des workflows principaux : quick-start, game-brief, gdd, brainstorm. Ces fichiers d√©finissent la structure, les √©tapes, et les questions.

## Pr√©requis

- [x] P1.1 - Structure globale avec workflows/defaults/

## Fichiers √† Cr√©er

```
~/.unreal-companion/workflows/defaults/
‚îú‚îÄ‚îÄ quick-start.yaml       # 2 min - pitch rapide
‚îú‚îÄ‚îÄ game-brief.yaml        # 15-30 min - vision compl√®te
‚îú‚îÄ‚îÄ gdd.yaml               # 1h+ - design document
‚îú‚îÄ‚îÄ brainstorm.yaml        # 10 min - id√©es libres
‚îî‚îÄ‚îÄ sprint-planning.yaml   # 15 min - planifier les tasks
```

## Sp√©cifications

### Format Workflow YAML

```yaml
id: game-brief
version: "1.0"

# M√©tadonn√©es
metadata:
  name:
    en: "Game Brief"
    fr: "Brief de Jeu"
  description:
    en: "Define your game vision, genre, and core mechanics"
    fr: "D√©finir la vision, le genre et les m√©caniques de base"
  icon: "üéØ"
  color: "#3B82F6"
  estimated_duration: "15-30 min"
  category: "conception"  # conception | production | brainstorm

# Agent par d√©faut
agent: game-designer

# Output configuration
output:
  type: markdown
  path: "artifacts/briefs/game-brief.md"
  update_context: true  # Met √† jour context.md

# √âtapes du workflow
steps:
  - id: vision
    title:
      en: "Core Vision"
      fr: "Vision Principale"

    # Message de l'agent (dynamique, utilis√© comme guide)
    agent_message:
      en: "Let's capture the essence of your game! What's the one-sentence pitch that makes people go 'I want to play that!'?"
      fr: "D√©finissons l'essence de ton jeu ! Quel est le pitch en une phrase qui donne envie de jouer ?"

    # Questions de l'√©tape
    questions:
      - id: elevator_pitch
        type: textarea
        prompt:
          en: "Describe your game in one compelling sentence"
          fr: "D√©cris ton jeu en une phrase percutante"
        placeholder:
          en: "In [Game Name], you play as... who must... by..."
          fr: "Dans [Nom du Jeu], tu incarnes... qui doit... en..."
        required: true
        validation:
          min_length: 20
          max_length: 500

      - id: core_fantasy
        type: textarea
        prompt:
          en: "What fantasy does the player experience?"
          fr: "Quelle exp√©rience/fantasme le joueur vit-il ?"
        description:
          en: "The core feeling or power fantasy that drives engagement"
          fr: "Le sentiment ou la fantaisie de pouvoir qui engage le joueur"
        required: true

    # Milestone optionnel apr√®s cette √©tape
    milestone:
      name:
        en: "Vision Defined"
        fr: "Vision D√©finie"
      celebration:
        en: "Your core vision is set! This is the foundation of everything."
        fr: "Ta vision est pos√©e ! C'est la fondation de tout le reste."

  - id: genre
    title:
      en: "Genre & References"
      fr: "Genre & R√©f√©rences"

    agent_message:
      en: "Great vision! Now let's position it. What genres inspire your game?"
      fr: "Excellente vision ! Maintenant, positionnons-la. Quels genres t'inspirent ?"

    questions:
      - id: primary_genre
        type: single
        prompt:
          en: "What's the primary genre?"
          fr: "Quel est le genre principal ?"
        options:
          - id: action
            label:
              en: "Action"
              fr: "Action"
          - id: adventure
            label:
              en: "Adventure"
              fr: "Aventure"
          - id: rpg
            label:
              en: "RPG"
              fr: "RPG"
          - id: puzzle
            label:
              en: "Puzzle"
              fr: "Puzzle"
          - id: simulation
            label:
              en: "Simulation"
              fr: "Simulation"
          - id: strategy
            label:
              en: "Strategy"
              fr: "Strat√©gie"
          - id: other
            label:
              en: "Other"
              fr: "Autre"
            allow_custom: true
        required: true

      - id: references
        type: multiple
        prompt:
          en: "Which games inspire you? (select all that apply)"
          fr: "Quels jeux t'inspirent ? (s√©lectionne tous ceux qui s'appliquent)"
        description:
          en: "The LLM will suggest based on your genre"
          fr: "Le LLM sugg√©rera en fonction de ton genre"
        suggestions_from_context: true  # LLM g√©n√®re des suggestions
        min_selections: 1
        max_selections: 5
        allow_custom: true

  - id: mechanics
    title:
      en: "Core Mechanics"
      fr: "M√©caniques Principales"

    # Condition d'affichage optionnelle
    show_if:
      question: primary_genre
      not_equals: puzzle  # Skip si puzzle (questions diff√©rentes)

    agent_message:
      en: "Now the fun part - what does the player actually DO?"
      fr: "Maintenant le plus fun - que fait concr√®tement le joueur ?"

    questions:
      - id: core_loop
        type: textarea
        prompt:
          en: "Describe the main gameplay loop"
          fr: "D√©cris la boucle de gameplay principale"
        description:
          en: "What actions repeat? What's the reward cycle?"
          fr: "Quelles actions se r√©p√®tent ? Quel est le cycle de r√©compense ?"
        required: true

      - id: unique_mechanic
        type: textarea
        prompt:
          en: "What makes your game unique mechanically?"
          fr: "Qu'est-ce qui rend ton jeu unique m√©caniquement ?"
        required: false

  # √âtape finale
  - id: summary
    title:
      en: "Summary"
      fr: "R√©sum√©"

    agent_message:
      en: "Awesome! Let me summarize what we've defined..."
      fr: "Super ! Laisse-moi r√©sumer ce qu'on a d√©fini..."

    # Pas de questions, juste g√©n√©ration du document
    generate_summary: true

# C√©l√©bration finale
completion:
  celebration:
    en: "üéâ Game Brief complete! You have a solid foundation for {{project_name}}."
    fr: "üéâ Brief termin√© ! Tu as une base solide pour {{project_name}}."
  next_suggestions:
    - workflow: gdd
      label:
        en: "Create full GDD"
        fr: "Cr√©er le GDD complet"
    - workflow: brainstorm
      label:
        en: "Brainstorm mechanics"
        fr: "Brainstormer les m√©caniques"
```

### quick-start.yaml (simplifi√©)

```yaml
id: quick-start
version: "1.0"

metadata:
  name:
    en: "Quick Start"
    fr: "D√©marrage Rapide"
  description:
    en: "Get started in 2 minutes with just the essentials"
    fr: "D√©marre en 2 minutes avec l'essentiel"
  icon: "üöÄ"
  color: "#10B981"
  estimated_duration: "2 min"
  category: "conception"

agent: game-designer

output:
  type: markdown
  path: "artifacts/briefs/quick-brief.md"
  update_context: true

steps:
  - id: basics
    title:
      en: "The Basics"
      fr: "L'Essentiel"

    agent_message:
      en: "Let's get the essentials down quickly! What's your game about?"
      fr: "Allons √† l'essentiel ! C'est quoi ton jeu ?"

    questions:
      - id: name
        type: text
        prompt:
          en: "What's the project name?"
          fr: "Comment s'appelle le projet ?"
        required: true

      - id: pitch
        type: textarea
        prompt:
          en: "One-sentence pitch"
          fr: "Pitch en une phrase"
        required: true

      - id: genre
        type: single
        prompt:
          en: "Genre?"
          fr: "Genre ?"
        options:
          - { id: action, label: { en: "Action", fr: "Action" } }
          - { id: rpg, label: { en: "RPG", fr: "RPG" } }
          - { id: puzzle, label: { en: "Puzzle", fr: "Puzzle" } }
          - { id: other, label: { en: "Other", fr: "Autre" }, allow_custom: true }
        required: true

completion:
  celebration:
    en: "üöÄ You're set! Your project is ready to explore."
    fr: "üöÄ C'est parti ! Ton projet est pr√™t."
  next_suggestions:
    - workflow: game-brief
      label:
        en: "Deep dive with full Game Brief"
        fr: "Approfondir avec le Brief complet"
```

## Crit√®res d'Acceptation

- [ ] quick-start.yaml cr√©√© et valide
- [ ] game-brief.yaml cr√©√© avec toutes les √©tapes
- [ ] gdd.yaml cr√©√© (peut √™tre partiel, structure d√©finie)
- [ ] brainstorm.yaml cr√©√©
- [ ] sprint-planning.yaml cr√©√©
- [ ] Tous les fichiers ont les traductions en/fr
- [ ] Format YAML valid√© (pas d'erreurs de syntaxe)
- [ ] Champs obligatoires pr√©sents (id, steps, output)
- [ ] Tests de parsing passent

## Tests √† √âcrire

### Unit Tests

```python
def test_parse_workflow_yaml():
    # V√©rifie que tous les workflows se parsent sans erreur

def test_workflow_has_required_fields():
    # V√©rifie id, steps, output pour chaque workflow

def test_workflow_translations_complete():
    # V√©rifie que en/fr sont pr√©sents partout

def test_question_types_valid():
    # V√©rifie que les types sont support√©s (text, textarea, single, multiple)
```

## Notes

- Les workflows sont en YAML pour √™tre lisibles/√©ditables par les utilisateurs
- Le LLM utilise ces d√©finitions mais g√©n√®re les messages dynamiquement
- `suggestions_from_context: true` indique que le LLM doit sugg√©rer des options
- Les conditions `show_if` permettent des workflows adaptatifs
