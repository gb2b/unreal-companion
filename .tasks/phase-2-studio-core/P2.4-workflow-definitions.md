# P2.4 Workflows YAML (DÃ©finitions)

## Status: âœ… COMPLÃ‰TÃ‰

## Objectif

CrÃ©er les dÃ©finitions YAML des workflows principaux : quick-start, game-brief, gdd, brainstorm. Ces fichiers dÃ©finissent la structure, les Ã©tapes, et les questions.

## PrÃ©requis

- [x] P1.1 - Structure globale avec workflows/defaults/

## ImplÃ©mentation Actuelle

Les workflows sont implÃ©mentÃ©s dans `web-ui/server/templates/workflows/` avec le pattern step-file (BMGD).

```
web-ui/server/templates/workflows/
â”œâ”€â”€ project-lite/          # = quick-start (2 min)
â”‚   â”œâ”€â”€ workflow.yaml
â”‚   â””â”€â”€ steps/step-*.md
â”œâ”€â”€ game-brief/            # Vision complÃ¨te (30-45 min)
â”‚   â”œâ”€â”€ workflow.yaml
â”‚   â””â”€â”€ steps/step-*.md    # 8 Ã©tapes
â”œâ”€â”€ gdd/                   # Design document (2-4h)
â”‚   â”œâ”€â”€ workflow.yaml
â”‚   â””â”€â”€ steps/step-*.md    # 9 Ã©tapes
â”œâ”€â”€ brainstorming/         # IdÃ©es libres (open-ended)
â”‚   â”œâ”€â”€ workflow.yaml
â”‚   â””â”€â”€ steps/step-*.md
â””â”€â”€ sprint-planning/       # Planification sprint (15 min)
    â”œâ”€â”€ workflow.yaml
    â””â”€â”€ steps/step-*.md    # 5 Ã©tapes
```

### Format SimplifiÃ© (vs spec)

Le format actuel est plus simple que la spec originale:

- **Pas d'i18n** (en/fr) - English only pour MVP
- **Metadata plate** - pas de nesting `metadata.name.en`
- **Steps en fichiers sÃ©parÃ©s** - pattern BMGD fonctionnel

## SpÃ©cifications

### Format Workflow YAML

```yaml
id: game-brief
version: "1.0"

# MÃ©tadonnÃ©es
metadata:
  name:
    en: "Game Brief"
    fr: "Brief de Jeu"
  description:
    en: "Define your game vision, genre, and core mechanics"
    fr: "DÃ©finir la vision, le genre et les mÃ©caniques de base"
  icon: "ğŸ¯"
  color: "#3B82F6"
  estimated_duration: "15-30 min"
  category: "conception"  # conception | production | brainstorm

# Agent par dÃ©faut
agent: game-designer

# Output configuration
output:
  type: markdown
  path: "artifacts/briefs/game-brief.md"
  update_context: true  # Met Ã  jour context.md

# Ã‰tapes du workflow
steps:
  - id: vision
    title:
      en: "Core Vision"
      fr: "Vision Principale"

    # Message de l'agent (dynamique, utilisÃ© comme guide)
    agent_message:
      en: "Let's capture the essence of your game! What's the one-sentence pitch that makes people go 'I want to play that!'?"
      fr: "DÃ©finissons l'essence de ton jeu ! Quel est le pitch en une phrase qui donne envie de jouer ?"

    # Questions de l'Ã©tape
    questions:
      - id: elevator_pitch
        type: textarea
        prompt:
          en: "Describe your game in one compelling sentence"
          fr: "DÃ©cris ton jeu en une phrase percutante"
        placeholder:
          en: "In [Game Name], you play as... who must... by..."
          fr: "Dans [Nom du Jeu], tu incarnes... qui doit... en..."
        required: true
        validation:
          min_length: 20
          max_length: 500

      - id: core_fantasy
        type: textarea
        prompt:
          en: "What fantasy does the player experience?"
          fr: "Quelle expÃ©rience/fantasme le joueur vit-il ?"
        description:
          en: "The core feeling or power fantasy that drives engagement"
          fr: "Le sentiment ou la fantaisie de pouvoir qui engage le joueur"
        required: true

    # Milestone optionnel aprÃ¨s cette Ã©tape
    milestone:
      name:
        en: "Vision Defined"
        fr: "Vision DÃ©finie"
      celebration:
        en: "Your core vision is set! This is the foundation of everything."
        fr: "Ta vision est posÃ©e ! C'est la fondation de tout le reste."

  - id: genre
    title:
      en: "Genre & References"
      fr: "Genre & RÃ©fÃ©rences"

    agent_message:
      en: "Great vision! Now let's position it. What genres inspire your game?"
      fr: "Excellente vision ! Maintenant, positionnons-la. Quels genres t'inspirent ?"

    questions:
      - id: primary_genre
        type: single
        prompt:
          en: "What's the primary genre?"
          fr: "Quel est le genre principal ?"
        options:
          - id: action
            label:
              en: "Action"
              fr: "Action"
          - id: adventure
            label:
              en: "Adventure"
              fr: "Aventure"
          - id: rpg
            label:
              en: "RPG"
              fr: "RPG"
          - id: puzzle
            label:
              en: "Puzzle"
              fr: "Puzzle"
          - id: simulation
            label:
              en: "Simulation"
              fr: "Simulation"
          - id: strategy
            label:
              en: "Strategy"
              fr: "StratÃ©gie"
          - id: other
            label:
              en: "Other"
              fr: "Autre"
            allow_custom: true
        required: true

      - id: references
        type: multiple
        prompt:
          en: "Which games inspire you? (select all that apply)"
          fr: "Quels jeux t'inspirent ? (sÃ©lectionne tous ceux qui s'appliquent)"
        description:
          en: "The LLM will suggest based on your genre"
          fr: "Le LLM suggÃ©rera en fonction de ton genre"
        suggestions_from_context: true  # LLM gÃ©nÃ¨re des suggestions
        min_selections: 1
        max_selections: 5
        allow_custom: true

  - id: mechanics
    title:
      en: "Core Mechanics"
      fr: "MÃ©caniques Principales"

    # Condition d'affichage optionnelle
    show_if:
      question: primary_genre
      not_equals: puzzle  # Skip si puzzle (questions diffÃ©rentes)

    agent_message:
      en: "Now the fun part - what does the player actually DO?"
      fr: "Maintenant le plus fun - que fait concrÃ¨tement le joueur ?"

    questions:
      - id: core_loop
        type: textarea
        prompt:
          en: "Describe the main gameplay loop"
          fr: "DÃ©cris la boucle de gameplay principale"
        description:
          en: "What actions repeat? What's the reward cycle?"
          fr: "Quelles actions se rÃ©pÃ¨tent ? Quel est le cycle de rÃ©compense ?"
        required: true

      - id: unique_mechanic
        type: textarea
        prompt:
          en: "What makes your game unique mechanically?"
          fr: "Qu'est-ce qui rend ton jeu unique mÃ©caniquement ?"
        required: false

  # Ã‰tape finale
  - id: summary
    title:
      en: "Summary"
      fr: "RÃ©sumÃ©"

    agent_message:
      en: "Awesome! Let me summarize what we've defined..."
      fr: "Super ! Laisse-moi rÃ©sumer ce qu'on a dÃ©fini..."

    # Pas de questions, juste gÃ©nÃ©ration du document
    generate_summary: true

# CÃ©lÃ©bration finale
completion:
  celebration:
    en: "ğŸ‰ Game Brief complete! You have a solid foundation for {{project_name}}."
    fr: "ğŸ‰ Brief terminÃ© ! Tu as une base solide pour {{project_name}}."
  next_suggestions:
    - workflow: gdd
      label:
        en: "Create full GDD"
        fr: "CrÃ©er le GDD complet"
    - workflow: brainstorm
      label:
        en: "Brainstorm mechanics"
        fr: "Brainstormer les mÃ©caniques"
```

### quick-start.yaml (simplifiÃ©)

```yaml
id: quick-start
version: "1.0"

metadata:
  name:
    en: "Quick Start"
    fr: "DÃ©marrage Rapide"
  description:
    en: "Get started in 2 minutes with just the essentials"
    fr: "DÃ©marre en 2 minutes avec l'essentiel"
  icon: "ğŸš€"
  color: "#10B981"
  estimated_duration: "2 min"
  category: "conception"

agent: game-designer

output:
  type: markdown
  path: "artifacts/briefs/quick-brief.md"
  update_context: true

steps:
  - id: basics
    title:
      en: "The Basics"
      fr: "L'Essentiel"

    agent_message:
      en: "Let's get the essentials down quickly! What's your game about?"
      fr: "Allons Ã  l'essentiel ! C'est quoi ton jeu ?"

    questions:
      - id: name
        type: text
        prompt:
          en: "What's the project name?"
          fr: "Comment s'appelle le projet ?"
        required: true

      - id: pitch
        type: textarea
        prompt:
          en: "One-sentence pitch"
          fr: "Pitch en une phrase"
        required: true

      - id: genre
        type: single
        prompt:
          en: "Genre?"
          fr: "Genre ?"
        options:
          - { id: action, label: { en: "Action", fr: "Action" } }
          - { id: rpg, label: { en: "RPG", fr: "RPG" } }
          - { id: puzzle, label: { en: "Puzzle", fr: "Puzzle" } }
          - { id: other, label: { en: "Other", fr: "Autre" }, allow_custom: true }
        required: true

completion:
  celebration:
    en: "ğŸš€ You're set! Your project is ready to explore."
    fr: "ğŸš€ C'est parti ! Ton projet est prÃªt."
  next_suggestions:
    - workflow: game-brief
      label:
        en: "Deep dive with full Game Brief"
        fr: "Approfondir avec le Brief complet"
```

## CritÃ¨res d'Acceptation

- [x] quick-start.yaml crÃ©Ã© et valide â†’ `project-lite/workflow.yaml`
- [x] game-brief.yaml crÃ©Ã© avec toutes les Ã©tapes â†’ 8 steps
- [x] gdd.yaml crÃ©Ã© â†’ 9 steps
- [x] brainstorm.yaml crÃ©Ã© â†’ `brainstorming/workflow.yaml`
- [x] sprint-planning.yaml crÃ©Ã© â†’ 5 steps
- [ ] ~~Tous les fichiers ont les traductions en/fr~~ â†’ DÃ©placÃ© en P6.0 i18n
- [x] Format YAML validÃ© (pas d'erreurs de syntaxe)
- [x] Champs obligatoires prÃ©sents (id, steps, output)
- [x] WorkflowEngine parse correctement tous les workflows

## Tests Ã  Ã‰crire

### Unit Tests

```python
def test_parse_workflow_yaml():
    # VÃ©rifie que tous les workflows se parsent sans erreur

def test_workflow_has_required_fields():
    # VÃ©rifie id, steps, output pour chaque workflow

def test_workflow_translations_complete():
    # VÃ©rifie que en/fr sont prÃ©sents partout

def test_question_types_valid():
    # VÃ©rifie que les types sont supportÃ©s
```

## Types de Questions SupportÃ©s

### Types de Base

| Type | Description | Exemple |
| ---- | ----------- | ------- |
| `text` | Champ texte une ligne | Nom du projet |
| `textarea` | Champ texte multi-lignes | Description, pitch |
| `single` | Choix unique (radio) | Genre principal |
| `multiple` | Choix multiples (checkbox) | RÃ©fÃ©rences, tags |

### Types Interactifs (voir P2.5)

| Type | Description | Exemple |
| ---- | ----------- | ------- |
| `spectrum` | Jauge entre deux extrÃªmes | LinÃ©aire â†” Non-linÃ©aire |
| `emotional_scale` | Ã‰chelle d'Ã©mojis | ğŸ˜° ğŸ˜ ğŸ¤” ğŸ˜® ğŸ¤© |
| `visual_ab` | Choix A/B avec visuels | "Dark Souls" vs "XCOM" |
| `appreciation` | Jauge de feedback | ğŸ‘ ğŸ˜ ğŸ‘ â¤ï¸ ğŸ”¥ |

### Exemple de Question Interactive

```yaml
questions:
  - id: progression_style
    type: spectrum
    prompt:
      en: "How linear should the progression be?"
      fr: "Ã€ quel point la progression doit Ãªtre linÃ©aire ?"
    extremes:
      left:
        label: { en: "Linear", fr: "LinÃ©aire" }
        description: { en: "Guided path", fr: "Chemin guidÃ©" }
      right:
        label: { en: "Open", fr: "Ouvert" }
        description: { en: "Player choice", fr: "Choix du joueur" }
    allow_comment: true  # Permet un commentaire optionnel

  - id: target_emotion
    type: emotional_scale
    prompt:
      en: "What emotion should the player feel?"
      fr: "Quelle Ã©motion le joueur doit ressentir ?"
    scale:
      - { emoji: "ğŸ˜°", label: { en: "Anxiety", fr: "AnxiÃ©tÃ©" } }
      - { emoji: "ğŸ˜", label: { en: "Calm", fr: "Calme" } }
      - { emoji: "ğŸ¤”", label: { en: "Curiosity", fr: "CuriositÃ©" } }
      - { emoji: "ğŸ˜®", label: { en: "Wonder", fr: "Ã‰merveillement" } }
      - { emoji: "ğŸ¤©", label: { en: "Euphoria", fr: "Euphorie" } }
```

### Quick Interactions (optionnelles dans workflow)

```yaml
# Peut Ãªtre ajoutÃ© dans une step pour dÃ©bloquer les idÃ©es
quick_interaction:
  type: speed_round  # speed_round | this_or_that | word_association | wild_card
  config:
    word_count: 5      # Pour speed_round
    timer: 15          # Secondes (optionnel, 0 = pas de timer)
    questions_count: 10  # Pour this_or_that
```

## Architecture Step-File (BMGD Pattern)

> Pour les workflows complexes (game-brief, gdd), utiliser l'architecture step-file de BMGD.
> Source : [bmad-module-game-dev-studio](https://github.com/bmad-code-org/bmad-module-game-dev-studio)

### Structure dossier (workflows complexes)

```
~/.unreal-companion/workflows/defaults/game-brief/
â”œâ”€â”€ workflow.yaml              # Config principale (mÃ©tadonnÃ©es, output)
â”œâ”€â”€ instructions.md            # Guidance LLM gÃ©nÃ©rale
â”œâ”€â”€ checklist.md               # CritÃ¨res de validation finale
â”œâ”€â”€ steps/
â”‚   â”œâ”€â”€ step-01-init.md        # DÃ©tection Ã©tat + init frontmatter
â”‚   â”œâ”€â”€ step-01b-continue.md   # Reprise session existante
â”‚   â”œâ”€â”€ step-02-vision.md      # Ã‰tape vision
â”‚   â”œâ”€â”€ step-03-genre.md       # Ã‰tape genre
â”‚   â”œâ”€â”€ step-04-mechanics.md   # Ã‰tape mÃ©caniques
â”‚   â””â”€â”€ step-05-complete.md    # Finalisation + validation
â””â”€â”€ templates/
    â””â”€â”€ game-brief-template.md  # Template avec {{variables}}
```

### RÃ¨gles LLM obligatoires (en haut de chaque step)

```markdown
## MANDATORY EXECUTION RULES

- Ne pas dÃ©vier, skip, ou optimiser la sÃ©quence
- JAMAIS gÃ©nÃ©rer de contenu sans input utilisateur
- TOUJOURS lire le fichier step ENTIER avant exÃ©cution
- JAMAIS charger plusieurs step files en mÃªme temps
- ComplÃ©ter la lecture avant d'agir
```

### Menu-driven progression

```markdown
## OPTIONS UTILISATEUR

[A] Accepter l'output actuel
[P] Donner du feedback / demander des modifications
[C] Continuer vers l'Ã©tape suivante
[AE] Advanced Elicitation (questions approfondies)

âš ï¸ SEUL [C] Continue sauvegarde l'Ã©tat et avance le workflow
```

### Frontmatter state tracking

```yaml
---
workflowId: game-brief
workflowName: Game Brief
workflowVersion: 1.0.0
projectName: "{{project_name}}"
stepsCompleted: [1, 2]         # Array des Ã©tapes terminÃ©es
currentStep: 3
lastUpdated: 2024-01-22T14:32:00Z
workflowStatus: in-progress     # in-progress | paused | complete
inputDocuments:
  - type: brainstorming
    name: Ideas.md
lastEditorAgent: game-designer
---
```

### Exemple step file (step-02-vision.md)

```markdown
## MANDATORY EXECUTION RULES
[rÃ¨gles ci-dessus]

## ROLE: Game Designer (Zelda)
Agis en facilitateur passionnÃ©. Style enthousiaste mais structurÃ©.

## PRIMARY GOAL
Capturer la vision core du jeu en une phrase percutante.

## DISCOVERY PATHS
- PATH A (Brief existant) : Proposer de confirmer/ajuster
- PATH B (Brainstorm existant) : Extraire les idÃ©es principales
- PATH C (Nouveau) : Questions guidÃ©es

## EXECUTION SEQUENCE
1. Saluer et rappeler le contexte
2. Poser la question du pitch
3. Attendre la rÃ©ponse utilisateur
4. RÃ©agir positivement et reformuler
5. Poser la question du core fantasy
6. SynthÃ©tiser
7. Afficher le menu [A] [P] [C] [AE]

## SUCCESS CRITERIA
âœ“ Pitch en une phrase (20-200 caractÃ¨res)
âœ“ Core fantasy identifiÃ©
âœ“ Utilisateur satisfait (a choisi [A] ou [C])

## FAILURE CRITERIA
âœ— Pitch trop vague ou gÃ©nÃ©rique
âœ— Pas de core fantasy dÃ©fini
âœ— Skip sans input utilisateur
```

## Notes

- Les workflows sont en YAML pour Ãªtre lisibles/Ã©ditables par les utilisateurs
- Le LLM utilise ces dÃ©finitions mais gÃ©nÃ¨re les messages dynamiquement
- `suggestions_from_context: true` indique que le LLM doit suggÃ©rer des options
- Les conditions `show_if` permettent des workflows adaptatifs
- Les types interactifs rendent l'expÃ©rience plus ludique (voir P2.5)
- Pour les workflows simples (quick-start), un seul YAML suffit
- Pour les workflows complexes (game-brief, gdd), utiliser l'architecture step-file
