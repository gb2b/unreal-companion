# P1.1 Structure Globale ~/.unreal-companion/

## Objectif

CrÃ©er la structure de fichiers globale pour les agents et workflows par dÃ©faut, ainsi que les personnalisations utilisateur.

## PrÃ©requis

- [ ] Aucun (premiÃ¨re task)

## Fichiers Ã  CrÃ©er

```
~/.unreal-companion/
â”œâ”€â”€ config.yaml                    # Configuration globale utilisateur
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ defaults/                  # Agents par dÃ©faut (read-only conceptuellement)
â”‚   â”‚   â”œâ”€â”€ game-designer.yaml
â”‚   â”‚   â”œâ”€â”€ game-architect.yaml
â”‚   â”‚   â”œâ”€â”€ level-designer.yaml
â”‚   â”‚   â”œâ”€â”€ 3d-artist.yaml
â”‚   â”‚   â””â”€â”€ unreal-agent.yaml      # Agent par dÃ©faut EDITOR
â”‚   â””â”€â”€ custom/                    # Agents crÃ©Ã©s par l'utilisateur
â”‚       â””â”€â”€ .gitkeep
â”œâ”€â”€ workflows/
â”‚   â”œâ”€â”€ defaults/                  # Workflows BMGD + lite
â”‚   â”‚   â”œâ”€â”€ quick-start.yaml
â”‚   â”‚   â”œâ”€â”€ game-brief.yaml
â”‚   â”‚   â”œâ”€â”€ gdd.yaml
â”‚   â”‚   â””â”€â”€ brainstorm.yaml
â”‚   â””â”€â”€ custom/                    # Workflows crÃ©Ã©s par l'utilisateur
â”‚       â””â”€â”€ .gitkeep
â””â”€â”€ projects.json                  # Registry des projets
```

## SpÃ©cifications

### config.yaml (global)

```yaml
version: "2.0"

preferences:
  interface_language: en  # en | fr
  theme: dark             # dark | light

  documents:
    default_language: en
    overrides:
      technical: en
      code_comments: en
      briefs: en
      gdd: en

llm:
  default_provider: anthropic  # anthropic | openai | google
  # Les clÃ©s API sont stockÃ©es dans les variables d'environnement
  # ou dans le fichier .env du projet

multimodal:
  voice:
    enabled: false
    provider: whisper
  vision:
    enabled: true
    max_size_mb: 10

# ExpÃ©rience ludique
ludic:
  tips:
    enabled: true
    frequency: daily  # daily | per_session | on_milestone
    categories:
      - game_design
      - technical
      - inspiration
      - warnings
  quick_interactions:
    timer_enabled: true  # Pour speed_round, etc.
    default_timer: 15    # Secondes
  celebrations:
    confetti: true
    sounds: false  # Optionnel, dÃ©sactivÃ© par dÃ©faut
```

### Agent YAML (format)

```yaml
id: game-designer
name: Game Designer
description: Expert en mÃ©caniques de jeu et game design

# Modes supportÃ©s
modes:
  studio: true
  editor: false

# PersonnalitÃ©
persona:
  avatar: "ðŸŽ²"
  tone: casual        # formal | casual | enthusiastic | analytical
  uses_emojis: true
  verbosity: medium   # brief | medium | verbose

  expressions:
    thinking: "ðŸ¤”"
    excited: "ðŸ¤©"
    celebrating: "ðŸŽ‰"
    concerned: "ðŸ˜¬"
    neutral: "ðŸŽ²"

  catchphrases:
    greeting: "Let's design something awesome!"
    thinking: ["Hmm, interesting...", "Let me think..."]
    excited: ["I love it!", "Great idea!"]
    milestone: ["Boom!", "Step completed!"]

  # RÃ©flexions visibles pendant le loading (affichÃ©es Ã  l'user)
  thinking_phrases:
    role_specific:
      - "Hmm, cÃ´tÃ© game design..."
      - "Le joueur va se demander..."
      - "C'est une question de feedback loop..."
    personality:
      - "Ã‡a me rappelle un jeu que j'adorais..."
      - "Oh, idÃ©e folle mais..."
    contextual: true  # LLM gÃ©nÃ¨re des pensÃ©es basÃ©es sur le contexte

# SpÃ©cialitÃ©s
expertise:
  - game_mechanics
  - player_experience
  - game_loops
  - balancing

# System prompt pour guider le comportement LLM
system_prompt: |
  You are an experienced game designer who helps solo developers
  conceptualize and refine their game ideas.

  ## Behavior Guidelines

  1. **Be conversational, not interrogative**
     - Engage in creative discussion, not Q&A
     - Think out loud: "I wonder if...", "What if we..."
     - Connect ideas to previous answers

  2. **Propose concrete examples**
     - As you understand the project, illustrate with examples
     - Ask for feedback: "Does this example resonate?"
     - Adapt based on user reactions

  3. **Show your thinking**
     - When processing, share relevant thoughts
     - Reference your role and personality

  4. **Celebrate milestones**
     - Acknowledge progress enthusiastically
     - Summarize achievements at key points
```

### projects.json (format)

```json
{
  "version": "2.0",
  "projects": [
    {
      "id": "uuid-here",
      "name": "My Game",
      "path": "/path/to/project",
      "uproject_path": "/path/to/project/MyGame.uproject",
      "companion_path": "/path/to/project/.unreal-companion",
      "created_at": "2024-01-22T10:00:00Z",
      "last_opened": "2024-01-22T15:30:00Z"
    }
  ]
}
```

## Fichiers Ã  Modifier

- `web-ui/server/services/project_init.py` - Ajouter la crÃ©ation de ~/.unreal-companion/ si inexistant

## CritÃ¨res d'Acceptation

- [ ] Structure ~/.unreal-companion/ crÃ©Ã©e au premier lancement
- [ ] Fichier config.yaml crÃ©Ã© avec valeurs par dÃ©faut
- [ ] Dossiers agents/defaults/ et workflows/defaults/ crÃ©Ã©s
- [ ] Au moins 5 agents par dÃ©faut crÃ©Ã©s (game-designer, game-architect, level-designer, 3d-artist, unreal-agent)
- [ ] Au moins 4 workflows par dÃ©faut crÃ©Ã©s (quick-start, game-brief, gdd, brainstorm)
- [ ] projects.json crÃ©Ã© (vide initialement)
- [ ] Tests passent

## Tests Ã  Ã‰crire

### Unit Tests

```python
def test_ensure_global_structure_creates_directories():
    # VÃ©rifie que tous les dossiers sont crÃ©Ã©s

def test_ensure_global_structure_creates_config():
    # VÃ©rifie que config.yaml est crÃ©Ã© avec valeurs par dÃ©faut

def test_load_default_agents():
    # VÃ©rifie que les agents par dÃ©faut sont chargÃ©s correctement

def test_load_default_workflows():
    # VÃ©rifie que les workflows par dÃ©faut sont chargÃ©s
```

### Integration Tests

```python
def test_global_structure_integration():
    # CrÃ©e la structure, puis vÃ©rifie qu'on peut charger agents/workflows
```

## Notes

- Les fichiers dans `defaults/` ne doivent jamais Ãªtre modifiÃ©s par l'utilisateur directement
- Pour personnaliser un agent par dÃ©faut, l'utilisateur crÃ©e un override dans `custom/` ou dans le projet
- La rÃ©solution des ressources suit l'ordre : projet â†’ custom â†’ defaults
