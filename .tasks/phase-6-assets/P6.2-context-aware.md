# P6.2 Context-Aware Generation

## Objectif

Enrichir les prompts de génération avec le contexte du projet (style guide, mood boards, couleurs).

## Prérequis

- [x] P4.1 - Génération d'images
- [x] P2.2 - Boards visuels

## Fichiers à Créer

- `web-ui/server/services/context_prompt_builder.py`

## Spécifications

### Enrichissement de Prompt

```python
class ContextPromptBuilder:
    def build_prompt(
        self,
        user_prompt: str,
        project_path: str
    ) -> str:
        """Enrichit le prompt avec le contexte projet."""

        context_parts = []

        # Style guide
        style_guide = self.load_style_guide(project_path)
        if style_guide:
            context_parts.append(f"Art style: {style_guide}")

        # Mood board keywords
        mood_keywords = self.extract_mood_board_keywords(project_path)
        if mood_keywords:
            context_parts.append(f"Visual themes: {', '.join(mood_keywords)}")

        # Color palette
        colors = self.extract_color_palette(project_path)
        if colors:
            context_parts.append(f"Color palette: {', '.join(colors)}")

        # Combine
        full_prompt = f"{user_prompt}, {', '.join(context_parts)}"
        return full_prompt
```

### Flow

```
User: "Génère un concept art du Temple"
          │
          ▼
    Context enrichissement
    - GDD: "Temple ancien avec runes"
    - Mood board: "ethereal, mystical, blue glow"
    - Style: "semi-realistic concept art"
          │
          ▼
    Prompt final: "Concept art of ancient temple with
     mystical runes, ethereal atmosphere, blue glow,
     semi-realistic concept art style"
```

## Critères d'Acceptation

- [ ] Extraction du style guide
- [ ] Extraction des mots-clés mood board
- [ ] Extraction de la palette de couleurs
- [ ] Enrichissement automatique du prompt
- [ ] Option pour désactiver l'enrichissement
- [ ] Tests passent
